document.querySelectorAll(".nav-link").forEach((e) => {
  e.addEventListener("click", () => {
    let e = document.querySelector(".navbar-collapse"),
      t = bootstrap.Collapse.getInstance(e);
    t && t.hide();
  });
}),
  document.querySelectorAll(".nav-link").forEach((e) => {
    e.addEventListener("click", function () {
      document
        .querySelectorAll(".nav-link")
        .forEach((e) => e.classList.remove("active")),
        this.classList.add("active");
    });
  }),
  document
    .querySelector(".scroll-to-musicians")
    .addEventListener("click", function (e) {
      e.preventDefault();
      let t = document.querySelector("#musicians"),
        l = t.getBoundingClientRect().top + window.scrollY - 90;
      window.scrollTo({ top: l, behavior: "smooth" });
    }),
  document
    .querySelector(".scroll-to-about")
    .addEventListener("click", function (e) {
      e.preventDefault();
      let t = document.querySelector("#about"),
        l = t.getBoundingClientRect().top + window.scrollY - 90;
      window.scrollTo({ top: l, behavior: "smooth" });
    }),
  window.addEventListener("scroll", () => {
    let e = document.querySelectorAll("section"),
      t = document.querySelectorAll(".nav-link"),
      l = "";
    e.forEach((e) => {
      let t = e.offsetTop - 90;
      window.scrollY >= t && (l = e.getAttribute("id"));
    }),
      t.forEach((e) => {
        e.classList.remove("active");
        let t = e.getAttribute("href");
        window.scrollY < 300 && "#" === t
          ? e.classList.add("active")
          : l && t.includes(l) && e.classList.add("active");
      });
  });
const spinner = document.getElementById("loading-spinner");
document.getElementById("bookingForm").addEventListener("submit", function (e) {
  e.preventDefault(), (spinner.style.display = "block");
  let t = e.target,
    l = new FormData(t),
    o = new URLSearchParams();
  for (let n of l.entries()) o.append(n[0], n[1]);
  fetch(
    "https://script.google.com/macros/s/AKfycbxl38KlMq9BZP4TFoXtVuDG4iQNyy383pdugwW8vh4owwOEtkMiIffqQwLw-uuDyvbN/exec",
    { method: "POST", body: o }
  )
    .then((e) => {
      e.ok
        ? (window.location.href = "thanks.html")
        : alert("حدث خطأ أثناء الإرسال، حاول مرة أخرى.");
    })
    .catch((e) => {
      console.error(e), alert("فشل في الاتصال بالخادم.");
    })
    .finally(() => {
      spinner.style.display = "none";
    });
});

//map
document.getElementById("loadMapBtn").addEventListener("click", function () {
  const mapIframe = document.createElement("iframe");
  mapIframe.src =
    "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3433.560618919501!2d32.28164277557595!3d30.618154174639734!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14f8594066923a7b%3A0xe05d926acdfb85e7!2z2YXYs9ix2K0g2YXYr9ix2LPYqSDYqtmD2YbZiNmE2YjYrNmK2Kcg2KfZhNmF2LnZhNmI2YXYp9iq!5e0!3m2!1sen!2seg!4v1750659914809!5m2!1sen!2seg";
  mapIframe.width = "100%";
  mapIframe.height = "350";
  mapIframe.style.border = "0";
  mapIframe.loading = "lazy";
  mapIframe.allowFullscreen = true;
  mapIframe.referrerPolicy = "no-referrer-when-downgrade";

  const placeholder = document.getElementById("mapPlaceholder");
  placeholder.innerHTML = ""; // امسح الزر
  placeholder.appendChild(mapIframe); // ضيف الخريطة
});

//loader for form
document.addEventListener("DOMContentLoaded", () => {
  const homeSection = document.querySelector(".home");
  homeSection.style.backgroundImage =
    'linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.6)), url("images/home/rafeek_optimized.webp")';
  homeSection.style.backgroundSize = "cover";
  homeSection.style.backgroundRepeat = "no-repeat";
  homeSection.style.backgroundPosition = "center";
});
